## philosophy[crypto] 40pt, 338solves
```
Clam decided to start studying philosophy, and what is the difference between plus one and minus one anyway...

challenge
```

chall.pyというファイルが与えられたのでcatコマンドで中身を見てみる
```
cat chall.py
```
chell.py
```
from Crypto.Util.number import getPrime
from secret import flag

p = getPrime(512)
q = getPrime(512)

m = int.from_bytes(flag.encode(), "big")

n = p * q
e = 65537
c = pow(m, e, n)

phi = (p + 1) * (q + 1)

print(f"n: {n}")
print(f"e: {e}")
print(f"c: {c}")
print(f"\"phi\": {phi}")

"""
n: 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535593260495162656111028487919107927692512155290673
e: 65537
c: 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082597780007494535370991899386707740199516316196758
"phi": 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084573410416063246853198167436938724585247461433706053188624379514833802770205501907568228388536548010385588837258085711058519777393945044905741975952241886308
```
powが手掛かりになりそうだと思ったのでGoogleで
```
ctf crypto writeup pow
```
と調べました。
```
https://trap.jp/post/1582/
```
こちらのサイトを参考にしました。

現在
```math
c = m^e(mod\;n)\\
```
となっています。
以下の式を計算すると平文mが求まります。


```math
\displaylines{ 
\begin{align}
φ & = (p-1)(q-1)\\
d & = e^{-1}(mod\;φ)\\
m & = c^d(mod \;n)\\
\end{align}
} 
```

まずφを求めます。
```math
φ =pq-(p+q)+1・・・①
```

ここで問題文より、
```math
\displaylines{ 
\begin{align}
n & = pq\\
phi & = pq + (p+q) + 1\\
\end{align}
}
```
なので式変形して
```math

p+q = phi-n-1・・・②


```
ということが分かります。
②を①に代入すると
```math
\displaylines{ 
\begin{align}
φ & =n-(phi-n-1)+1\\
  & = 2n -phi +2
\end{align}
} 
```
次にdを求めます。
```math
\displaylines{ 
\begin{align}
d & = e^{-1}(mod\;φ)\\
  & = pow(e, -1, φ)
\end{align}
} 
```
最後に今までのを代入してmを求めます。
```math
\displaylines{ 
\begin{align}
m & = c^d(mod \;n)\\
  & = pow(c, d, n) 
\end{align}
} 
```
これらをコードにすると以下のようになりました。

```
from Crypto.Util.number import long_to_bytes

n = 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535593260495162656111028487919107927692512155290673

e = 65537

c = 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082597780007494535370991899386707740199516316196758

phi = 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084573410416063246853198167436938724585247461433706053188624379514833802770205501907568228388536548010385588837258085711058519777393945044905741975952241886308

f = 2*n - phi + 2 
d = pow(e, -1, f)
#d = (e ** -1) % f
m = pow(c, d, n)
#k = (c ** d) % n


print(m)
print("----------------")
#print(k)
print(long_to_bytes(m))
```

```
d = pow(e, -1, f)
#d = (e ** -1) % f
```

最初下で書いていてエラーにはまっていました。
ここら辺の理解がまだ甘いみたいです。
```
GPTより
pow(e, -1, f) は整数のモジュラ逆元を計算します。これは特定の数論的な問題を解決するためのものです。
e ** -1 % f は浮動小数点数の逆数を計算し、その結果を f で割った余りを求めますが、これは数論的なモジュラ逆元の計算とは異なります。
正確なモジュラ逆元を計算するためには、必ず pow(e, -1, f) を使用してください。
```


```
actf{its_okay_i_figured_out_phi_anyway}
```
